/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { StrategyIndex } from '../services/strategyIndex';
import { StorageKeyManager } from './storageKeyManager';
import { noop } from './noop';
export class DecoratorBuilder {
    /**
     * @param {?} strategyName
     * @param {?} prototype
     * @param {?} propName
     * @param {?=} key
     * @param {?=} defaultValue
     * @return {?}
     */
    static buildSyncStrategyDecorator(strategyName, prototype, propName, key, defaultValue = null) {
        /** @type {?} */
        const rawKey = key || propName;
        /** @type {?} */
        let storageKey;
        Object.defineProperty(prototype, propName, {
            get: function () {
                /** @type {?} */
                let value;
                StrategyIndex.get(strategyName).get(getKey()).subscribe((result) => value = result);
                return value === undefined ? defaultValue : value;
            },
            set: function (value) {
                StrategyIndex.get(strategyName).set(getKey(), value).subscribe(noop);
            }
        });
        /**
         * @return {?}
         */
        function getKey() {
            if (storageKey !== undefined)
                return storageKey;
            return storageKey = StorageKeyManager.normalize(rawKey);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC13ZWJzdG9yYWdlLyIsInNvdXJjZXMiOlsibGliL2hlbHBlcnMvZGVjb3JhdG9yQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBRXhELE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFFNUIsTUFBTSxPQUFPLGdCQUFnQjs7Ozs7Ozs7O0lBRTVCLE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxZQUF3QyxFQUFFLFNBQVMsRUFBRSxRQUFnQixFQUFFLEdBQVksRUFBRSxlQUFvQixJQUFJOztjQUN4SSxNQUFNLEdBQVcsR0FBRyxJQUFJLFFBQVE7O1lBQ2xDLFVBQWtCO1FBRXRCLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRTtZQUMxQyxHQUFHLEVBQUU7O29CQUNBLEtBQVU7Z0JBQ2QsYUFBYSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQztnQkFDcEYsT0FBTyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNuRCxDQUFDO1lBQ0QsR0FBRyxFQUFFLFVBQVMsS0FBSztnQkFDbEIsYUFBYSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RFLENBQUM7U0FDRCxDQUFDLENBQUM7Ozs7UUFFSCxTQUFTLE1BQU07WUFDZCxJQUFJLFVBQVUsS0FBSyxTQUFTO2dCQUFFLE9BQU8sVUFBVSxDQUFDO1lBQ2hELE9BQU8sVUFBVSxHQUFHLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0YsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTdHJhdGVneUluZGV4fSBmcm9tICcuLi9zZXJ2aWNlcy9zdHJhdGVneUluZGV4JztcclxuaW1wb3J0IHtTdG9yYWdlU3RyYXRlZ2llc30gZnJvbSAnLi4vY29uc3RhbnRzL3N0cmF0ZWd5JztcclxuaW1wb3J0IHtTdG9yYWdlS2V5TWFuYWdlcn0gZnJvbSAnLi9zdG9yYWdlS2V5TWFuYWdlcic7XHJcbmltcG9ydCB7bm9vcH0gZnJvbSAnLi9ub29wJztcclxuXHJcbmV4cG9ydCBjbGFzcyBEZWNvcmF0b3JCdWlsZGVyIHtcclxuXHRcclxuXHRzdGF0aWMgYnVpbGRTeW5jU3RyYXRlZ3lEZWNvcmF0b3Ioc3RyYXRlZ3lOYW1lOiBzdHJpbmcgfCBTdG9yYWdlU3RyYXRlZ2llcywgcHJvdG90eXBlLCBwcm9wTmFtZTogc3RyaW5nLCBrZXk/OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogYW55ID0gbnVsbCkge1xyXG5cdFx0Y29uc3QgcmF3S2V5OiBzdHJpbmcgPSBrZXkgfHwgcHJvcE5hbWU7XHJcblx0XHRsZXQgc3RvcmFnZUtleTogc3RyaW5nO1xyXG5cdFx0XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCBwcm9wTmFtZSwge1xyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdGxldCB2YWx1ZTogYW55O1xyXG5cdFx0XHRcdFN0cmF0ZWd5SW5kZXguZ2V0KHN0cmF0ZWd5TmFtZSkuZ2V0KGdldEtleSgpKS5zdWJzY3JpYmUoKHJlc3VsdCkgPT4gdmFsdWUgPSByZXN1bHQpO1xyXG5cdFx0XHRcdHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogdmFsdWU7XHJcblx0XHRcdH0sXHJcblx0XHRcdHNldDogZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0XHRTdHJhdGVneUluZGV4LmdldChzdHJhdGVneU5hbWUpLnNldChnZXRLZXkoKSwgdmFsdWUpLnN1YnNjcmliZShub29wKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIGdldEtleSgpIHtcclxuXHRcdFx0aWYgKHN0b3JhZ2VLZXkgIT09IHVuZGVmaW5lZCkgcmV0dXJuIHN0b3JhZ2VLZXk7XHJcblx0XHRcdHJldHVybiBzdG9yYWdlS2V5ID0gU3RvcmFnZUtleU1hbmFnZXIubm9ybWFsaXplKHJhd0tleSk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4iXX0=