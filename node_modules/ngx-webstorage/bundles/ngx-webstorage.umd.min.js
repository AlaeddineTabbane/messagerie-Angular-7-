!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("@angular/core"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-webstorage",["exports","rxjs/operators","@angular/core","rxjs","@angular/common"],t):t(e["ngx-webstorage"]={},e.rxjs.operators,e.ng.core,e.rxjs,e.ng.common)}(this,function(e,n,o,i,s){"use strict";var u={Local:"local_strategy",Session:"session_strategy",InMemory:"in_memory_strategy"};function c(){}var f=function(){function t(){}return t.normalize=function(e){return e=t.isCaseSensitive?e:e.toLowerCase(),""+t.prefix+t.separator+e},t.isNormalizedKey=function(e){return 0===e.indexOf(t.prefix+t.separator)},t.setPrefix=function(e){t.prefix=e},t.setSeparator=function(e){t.separator=e},t.setCaseSensitive=function(e){t.isCaseSensitive=e},t.consumeConfiguration=function(e){"prefix"in e&&this.setPrefix(e.prefix),"separator"in e&&this.setSeparator(e.separator),"caseSensitive"in e&&this.setCaseSensitive(e.caseSensitive)},t.prefix="ngx-webstorage",t.separator="|",t.isCaseSensitive=!1,t}(),r=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){var t;return this.strategy.get(f.normalize(e)).subscribe(function(e){return t=void 0===e?null:e}),t},e.prototype.store=function(e,t){return this.strategy.set(f.normalize(e),t).subscribe(c),t},e.prototype.clear=function(e){e!==undefined?this.strategy.del(f.normalize(e)).subscribe(c):this.strategy.clear().subscribe(c)},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(t){var e=this;return t=f.normalize(t),this.strategy.keyChanges.pipe(n.filter(function(e){return null===e||e===t}),n.switchMap(function(){return e.strategy.get(t)}),n.distinctUntilChanged(),n.shareReplay())},e}(),t=function(){function e(e){this.strategy=e}return e.prototype.retrieve=function(e){return this.strategy.get(f.normalize(e)).pipe(n.map(function(e){return void 0===e?null:e}))},e.prototype.store=function(e,t){return this.strategy.set(f.normalize(e),t)},e.prototype.clear=function(e){return e!==undefined?this.strategy.del(f.normalize(e)):this.strategy.clear()},e.prototype.getStrategyName=function(){return this.strategy.name},e.prototype.observe=function(t){var e=this;return t=f.normalize(t),this.strategy.keyChanges.pipe(n.filter(function(e){return null===e||e===t}),n.switchMap(function(){return e.strategy.get(t)}),n.distinctUntilChanged(),n.shareReplay())},e}(),l=function(){function e(){this.caches={}}return e.prototype.get=function(e,t){return this.getCacheStore(e)[t]},e.prototype.set=function(e,t,n){this.getCacheStore(e)[t]=n},e.prototype.del=function(e,t){delete this.getCacheStore(e)[t]},e.prototype.clear=function(e){this.caches[e]={}},e.prototype.getCacheStore=function(e){return e in this.caches?this.caches[e]:this.caches[e]={}},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=o.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),g=new o.InjectionToken("window_local_storage");function a(){return"undefined"!=typeof window?window.localStorage:null}var p={provide:g,useFactory:a},y=new o.InjectionToken("window_session_storage");function h(){return"undefined"!=typeof window?window.sessionStorage:null}var d={provide:y,useFactory:h},m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function S(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function v(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return a}var b=function(){function e(){}return e.isStorageAvailable=function(e){var t=!0;try{"object"==typeof e?(e.setItem("test-storage","foobar"),e.removeItem("test-storage")):t=!1}catch(n){t=!1}return t},e}(),x=function(){function e(e,t){this.storage=e,this.cache=t,this.keyChanges=new i.Subject}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return this._isAvailable===undefined&&(this._isAvailable=b.isStorageAvailable(this.storage)),this._isAvailable},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var t=this.cache.get(this.name,e);if(t!==undefined)return i.of(t);try{var n=this.storage.getItem(e);null!==n&&(t=JSON.parse(n),this.cache.set(this.name,e,t))}catch(r){console.warn(r)}return i.of(t)},e.prototype.set=function(e,t){var n=JSON.stringify(t);return this.storage.setItem(e,n),this.cache.set(this.name,e,t),this.keyChanges.next(e),i.of(t)},e.prototype.del=function(e){return this.storage.removeItem(e),this.cache.del(this.name,e),this.keyChanges.next(e),i.of(null)},e.prototype.clear=function(){return this.storage.clear(),this.cache.clear(this.name),this.keyChanges.next(null),i.of(null)},e}(),I=function(i){function a(e,t,n,r){var o=i.call(this,e,t)||this;return o.storage=e,o.cache=t,o.platformId=n,o.zone=r,o.name=a.strategyName,s.isPlatformBrowser(o.platformId)&&o.listenExternalChanges(),o}return S(a,i),a.prototype.listenExternalChanges=function(){var n=this;window.addEventListener("storage",function(t){return n.zone.run(function(){if(t.storageArea===n.storage){var e=t.key;null!==e?n.cache.del(n.name,t.key):n.cache.clear(n.name),n.keyChanges.next(e)}})})},a.strategyName=u.Local,a.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[g]}]},{type:l},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]},{type:o.NgZone}]},a}(x),w=function(i){function a(e,t,n,r){var o=i.call(this,e,t)||this;return o.storage=e,o.cache=t,o.platformId=n,o.zone=r,o.name=a.strategyName,s.isPlatformBrowser(o.platformId)&&o.listenExternalChanges(),o}return S(a,i),a.prototype.listenExternalChanges=function(){var n=this;window.addEventListener("storage",function(t){return n.zone.run(function(){if(t.storageArea===n.storage){var e=t.key;null!==t.key?n.cache.del(n.name,t.key):n.cache.clear(n.name),n.keyChanges.next(e)}})})},a.strategyName=u.Session,a.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[y]}]},{type:l},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]},{type:o.NgZone}]},a}(x),j=function(){function t(e){this.cache=e,this.keyChanges=new i.Subject,this.isAvailable=!0,this.name=t.strategyName}return t.prototype.get=function(e){return i.of(this.cache.get(this.name,e))},t.prototype.set=function(e,t){return this.cache.set(this.name,e,t),this.keyChanges.next(e),i.of(t)},t.prototype.del=function(e){return this.cache.del(this.name,e),this.keyChanges.next(e),i.of(null)},t.prototype.clear=function(){return this.cache.clear(this.name),this.keyChanges.next(null),i.of(null)},t.strategyName=u.InMemory,t.ctorParameters=function(){return[{type:l,decorators:[{type:o.Inject,args:[l]}]}]},t}(),C=new o.InjectionToken("STORAGE_STRATEGIES"),_=[{provide:C,useClass:j,multi:!0},{provide:C,useClass:I,multi:!0},{provide:C,useClass:w,multi:!0}],k="stub_strategy",O=function(){function e(e){this.keyChanges=new i.Subject,this.store={},this._available=!0,this.name=e||k}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return this._available},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return i.of(this.store[e])},e.prototype.set=function(e,t){return this.store[e]=t,this.keyChanges.next(e),i.of(t)},e.prototype.del=function(e){return delete this.store[e],this.keyChanges.next(e),i.of(null)},e.prototype.clear=function(){return this.store={},this.keyChanges.next(null),i.of(null)},e.ctorParameters=function(){return[{type:String,decorators:[{type:o.Optional}]}]},e}(),A=function(){function e(){this.store={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.store).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.store={}},e.prototype.getItem=function(e){return this.store[e]||null},e.prototype.key=function(e){return Object.keys(this.store)[e]},e.prototype.removeItem=function(e){delete this.store[e]},e.prototype.setItem=function(e,t){this.store[e]=t},e}(),P="invalid_strategy",E=function(){function r(t){this.strategies=t,this.registration$=new i.Subject,t||(t=[]),this.strategies=t.reverse().map(function(e,t,n){return e.name}).map(function(e,t,n){return n.indexOf(e)===t?t:null}).filter(function(e){return null!==e}).map(function(e){return t[e]})}return r.get=function(e){if(!this.isStrategyRegistered(e))throw Error(P);var t=r.index[e];return t.isAvailable||(t=r.index[u.InMemory]),t},r.set=function(e,t){r.index[e]=t},r.clear=function(e){e!==undefined?delete r.index[e]:r.index={}},r.isStrategyRegistered=function(e){return e in r.index},r.hasRegistredStrategies=function(){return 0<Object.keys(r.index).length},r.prototype.getStrategy=function(e){return r.get(e)},r.prototype.indexStrategies=function(){var t=this;this.strategies.forEach(function(e){return t.register(e.name,e)})},r.prototype.indexStrategy=function(t,e){if(void 0===e&&(e=!1),r.isStrategyRegistered(t)&&!e)return r.get(t);var n=this.strategies.find(function(e){return e.name===t});if(!n)throw new Error(P);return this.register(t,n,e),n},r.prototype.register=function(e,t,n){void 0===n&&(n=!1),r.isStrategyRegistered(e)&&!n||(r.set(e,t),this.registration$.next(e))},r.index={},r.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],r.ctorParameters=function(){return[{type:Array,decorators:[{type:o.Optional},{type:o.Inject,args:[C]}]}]},r.ngInjectableDef=o.defineInjectable({factory:function(){return new r(o.inject(C,8))},token:r,providedIn:"root"}),r}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t}(r);function R(e){var t=e.indexStrategy(u.Local);return new r(t)}var L={provide:N,useFactory:R,deps:[E]},T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t}(r);function z(e){var t=e.indexStrategy(u.Session);return new r(t)}var M={provide:T,useFactory:z,deps:[E]},F=function(){function e(){}return e.buildSyncStrategyDecorator=function(n,e,t,r,o){void 0===o&&(o=null);var i,a=r||t;function s(){return i!==undefined?i:i=f.normalize(a)}Object.defineProperty(e,t,{get:function(){var t;return E.get(n).get(s()).subscribe(function(e){return t=e}),t===undefined?o:t},set:function(e){E.get(n).set(s(),e).subscribe(c)}})},e}();var D=[L,M],G=new o.InjectionToken("ngx_webstorage_config");function q(e){return e.indexStrategies(),function(){return E.index}}var B=function(){function t(e,t){t?f.consumeConfiguration(t):console.error("NgxWebstorage : Possible misconfiguration (The forRoot method usage is mandatory since the 3.0.0)")}return t.forRoot=function(e){return void 0===e&&(e={}),{ngModule:t,providers:function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}([{provide:G,useValue:e},p,d],D,_,[{provide:o.APP_INITIALIZER,useFactory:q,deps:[E],multi:!0}])}},t.decorators=[{type:o.NgModule,args:[{}]}],t.ctorParameters=function(){return[{type:E},{type:undefined,decorators:[{type:o.Optional},{type:o.Inject,args:[G]}]}]},t}();e.LOCAL_STORAGE=g,e.SESSION_STORAGE=y,e.STORAGE_STRATEGIES=C,e.LocalStorageService=N,e.SessionStorageService=T,e.StorageStrategies=u,e.SyncStorage=r,e.AsyncStorage=t,e.StrategyCacheService=l,e.LocalStorageStrategy=I,e.SessionStorageStrategy=w,e.InMemoryStorageStrategy=j,e.StorageStrategyStubName=k,e.StorageStrategyStub=O,e.StorageStub=A,e.InvalidStrategyError=P,e.StrategyIndex=E,e.LocalStorage=function Z(n,r){return function(e,t){F.buildSyncStrategyDecorator(u.Local,e,t,n,r)}},e.SessionStorage=function J(n,r){return function(e,t){F.buildSyncStrategyDecorator(u.Session,e,t,n,r)}},e.appInit=q,e.LIB_CONFIG=G,e.NgxWebstorageModule=B,e.ɵb=p,e.ɵd=d,e.ɵa=a,e.ɵc=h,e.ɵn=D,e.ɵg=L,e.ɵf=R,e.ɵi=M,e.ɵh=z,e.ɵl=C,e.ɵj=x,e.ɵe=_,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-webstorage.umd.min.js.map